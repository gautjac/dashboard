<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Save to Dashboard - iOS Shortcut</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 500px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
      min-height: 100vh;
    }
    .card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      font-size: 24px;
      margin: 0 0 8px 0;
      color: #1a1a1a;
    }
    p {
      color: #666;
      margin: 0 0 20px 0;
      line-height: 1.5;
    }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
    }
    input {
      width: 100%;
      padding: 12px 16px;
      font-size: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      margin-bottom: 20px;
      font-family: monospace;
    }
    input:focus {
      outline: none;
      border-color: #007aff;
    }
    button {
      width: 100%;
      padding: 16px;
      font-size: 17px;
      font-weight: 600;
      color: white;
      background: #007aff;
      border: none;
      border-radius: 12px;
      cursor: pointer;
    }
    button:hover {
      background: #0066dd;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .steps {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid #e0e0e0;
    }
    .steps h2 {
      font-size: 18px;
      margin: 0 0 16px 0;
    }
    .steps ol {
      margin: 0;
      padding-left: 20px;
      color: #444;
    }
    .steps li {
      margin-bottom: 12px;
      line-height: 1.5;
    }
    .note {
      background: #fff3cd;
      border-radius: 8px;
      padding: 12px;
      margin-top: 16px;
      font-size: 14px;
      color: #856404;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Save to Dashboard</h1>
    <p>Generate an iOS Shortcut to save X/Twitter bookmarks from your phone's share sheet.</p>

    <label for="apiKey">Your API Key</label>
    <input type="text" id="apiKey" placeholder="dd_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" autocomplete="off" autocapitalize="off" autocorrect="off">

    <button id="downloadBtn" disabled>Download Shortcut</button>

    <div class="steps">
      <h2>After downloading:</h2>
      <ol>
        <li>Open the downloaded <strong>.shortcut</strong> file</li>
        <li>Tap <strong>"Add Shortcut"</strong> when prompted</li>
        <li>Open the X app, find a tweet, tap <strong>Share</strong></li>
        <li>Scroll down and tap <strong>"Save to Dashboard"</strong></li>
      </ol>
    </div>

    <div class="note">
      <strong>Don't have an API key?</strong> Generate one in your Dashboard Settings under the Bookmarks section.
    </div>
  </div>

  <script>
    const apiKeyInput = document.getElementById('apiKey');
    const downloadBtn = document.getElementById('downloadBtn');

    apiKeyInput.addEventListener('input', () => {
      const key = apiKeyInput.value.trim();
      downloadBtn.disabled = !key.startsWith('dd_') || key.length < 20;
    });

    downloadBtn.addEventListener('click', () => {
      const apiKey = apiKeyInput.value.trim();
      if (!apiKey) return;

      // Create the shortcut plist
      const shortcut = createShortcutPlist(apiKey);

      // Download it
      const blob = new Blob([shortcut], { type: 'application/x-apple-shortcut' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'Save to Dashboard.shortcut';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    function createShortcutPlist(apiKey) {
      const endpoint = `https://dashboard-jac.netlify.app/.netlify/functions/share-bookmark?key=${apiKey}`;

      return `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>WFWorkflowClientVersion</key>
	<string>2302.0.4</string>
	<key>WFWorkflowHasOutputFallback</key>
	<false/>
	<key>WFWorkflowHasShortcutInputVariables</key>
	<true/>
	<key>WFWorkflowIcon</key>
	<dict>
		<key>WFWorkflowIconGlyphNumber</key>
		<integer>61440</integer>
		<key>WFWorkflowIconStartColor</key>
		<integer>463140863</integer>
	</dict>
	<key>WFWorkflowImportQuestions</key>
	<array/>
	<key>WFWorkflowInputContentItemClasses</key>
	<array>
		<string>WFURLContentItem</string>
		<string>WFStringContentItem</string>
		<string>WFRichTextContentItem</string>
	</array>
	<key>WFWorkflowMinimumClientVersion</key>
	<integer>900</integer>
	<key>WFWorkflowMinimumClientVersionString</key>
	<string>900</string>
	<key>WFWorkflowName</key>
	<string>Save to Dashboard</string>
	<key>WFWorkflowOutputContentItemClasses</key>
	<array/>
	<key>WFWorkflowTypes</key>
	<array>
		<string>ActionExtension</string>
	</array>
	<key>WFWorkflowActions</key>
	<array>
		<dict>
			<key>WFWorkflowActionIdentifier</key>
			<string>is.workflow.actions.downloadurl</string>
			<key>WFWorkflowActionParameters</key>
			<dict>
				<key>ShowHeaders</key>
				<true/>
				<key>WFHTTPBodyType</key>
				<string>Json</string>
				<key>WFHTTPMethod</key>
				<string>POST</string>
				<key>WFJSONValues</key>
				<dict>
					<key>Value</key>
					<dict>
						<key>WFDictionaryFieldValueItems</key>
						<array>
							<dict>
								<key>WFItemType</key>
								<integer>0</integer>
								<key>WFKey</key>
								<dict>
									<key>Value</key>
									<dict>
										<key>string</key>
										<string>text</string>
									</dict>
									<key>WFSerializationType</key>
									<string>WFTextTokenString</string>
								</dict>
								<key>WFValue</key>
								<dict>
									<key>Value</key>
									<dict>
										<key>attachmentsByRange</key>
										<dict>
											<key>{0, 1}</key>
											<dict>
												<key>Type</key>
												<string>ExtensionInput</string>
											</dict>
										</dict>
										<key>string</key>
										<string>ï¿¼</string>
									</dict>
									<key>WFSerializationType</key>
									<string>WFTextTokenString</string>
								</dict>
							</dict>
						</array>
					</dict>
					<key>WFSerializationType</key>
					<string>WFDictionaryFieldValue</string>
				</dict>
				<key>WFURL</key>
				<dict>
					<key>Value</key>
					<dict>
						<key>string</key>
						<string>${endpoint}</string>
					</dict>
					<key>WFSerializationType</key>
					<string>WFTextTokenString</string>
				</dict>
				<key>WFHTTPHeaders</key>
				<dict>
					<key>Value</key>
					<dict>
						<key>WFDictionaryFieldValueItems</key>
						<array>
							<dict>
								<key>WFItemType</key>
								<integer>0</integer>
								<key>WFKey</key>
								<dict>
									<key>Value</key>
									<dict>
										<key>string</key>
										<string>Content-Type</string>
									</dict>
									<key>WFSerializationType</key>
									<string>WFTextTokenString</string>
								</dict>
								<key>WFValue</key>
								<dict>
									<key>Value</key>
									<dict>
										<key>string</key>
										<string>application/json</string>
									</dict>
									<key>WFSerializationType</key>
									<string>WFTextTokenString</string>
								</dict>
							</dict>
						</array>
					</dict>
					<key>WFSerializationType</key>
					<string>WFDictionaryFieldValue</string>
				</dict>
			</dict>
		</dict>
		<dict>
			<key>WFWorkflowActionIdentifier</key>
			<string>is.workflow.actions.notification</string>
			<key>WFWorkflowActionParameters</key>
			<dict>
				<key>WFNotificationActionBody</key>
				<dict>
					<key>Value</key>
					<dict>
						<key>string</key>
						<string>Bookmark saved to Dashboard</string>
					</dict>
					<key>WFSerializationType</key>
					<string>WFTextTokenString</string>
				</dict>
				<key>WFNotificationActionSound</key>
				<true/>
				<key>WFNotificationActionTitle</key>
				<dict>
					<key>Value</key>
					<dict>
						<key>string</key>
						<string>Saved!</string>
					</dict>
					<key>WFSerializationType</key>
					<string>WFTextTokenString</string>
				</dict>
			</dict>
		</dict>
	</array>
</dict>
</plist>`;
    }
  </script>
</body>
</html>
